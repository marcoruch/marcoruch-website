<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapping Meaning - Building a Semantic Search | Bites | Marco Ruch</title>
    <meta name="description" content="Build a semantic search engine from scratch using JavaScript embeddings. Learn how vector databases power modern search through interactive examples.">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="author" content="Marco Ruch">
    <meta name="theme-color" content="#10214b">
    <meta name="msapplication-TileColor" content="#10214b">
    <meta name="keywords" content="semantic search, embeddings, vector database, TF-IDF, natural language processing, search algorithms, machine learning">

    <!-- Canonical URL (SEO) -->
    <link rel="canonical" href="https://www.marcoruch.ch/bites/mapping-meaning/">
    
    <!-- Additional indexing hints -->
    <link rel="alternate" hreflang="en" href="https://www.marcoruch.ch/bites/mapping-meaning/">
    <link rel="alternate" hreflang="x-default" href="https://www.marcoruch.ch/bites/mapping-meaning/">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Mapping Meaning - Building a Semantic Search | Bites | Marco Ruch">
    <meta property="og:description" content="Build a semantic search engine from scratch using JavaScript embeddings. Learn how vector databases power modern search through interactive examples.">
    <meta property="og:url" content="https://www.marcoruch.ch/bites/mapping-meaning/">
    <meta property="og:site_name" content="Marco Ruch">
    <meta property="og:locale" content="en_GB">
    <meta property="og:image" content="https://www.marcoruch.ch/bites/assets/images/mapping-meaning_preview.webp">
    <meta property="og:image:alt" content="Mapping Meaning - Semantic Search Visualization">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/webp">
    <meta property="article:author" content="Marco Ruch">
    <meta property="article:published_time" content="2025-10-18T00:00:00Z">
    <meta property="article:section" content="Computer Science">
    <meta property="article:tag" content="Algorithms">
    <meta property="article:tag" content="Data Science">
    <meta property="article:tag" content="Machine Learning">

    <!-- Twitter Card (Social) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mapping Meaning - Building a Semantic Search | Bites | Marco Ruch">
    <meta name="twitter:description" content="Build a semantic search engine from scratch. Learn embeddings, vector databases, and similarity search.">
    <meta name="twitter:image" content="https://www.marcoruch.ch/bites/assets/images/mapping-meaning_preview.webp">
    <meta name="twitter:creator" content="@marcoruch">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon.ico">
    <link rel="shortcut icon" href="../../assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../../assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../assets/images/favicon-16x16.png">
    <link rel="manifest" href="../../assets/manifest.json" crossorigin="use-credentials">
    
    <!-- Performance Enhancements -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

    <!-- Preload critical resources -->
    <link rel="preload" href="../styles.css" as="style">
    <link rel="preload" href="../../assets/css/breadcrumbs.css" as="style">
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;500;700&display=swap">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- Shared Bites Styles -->
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../../assets/css/breadcrumbs.css">
    <link rel="stylesheet" href="../../assets/css/scrollbar.css">
    
    <!-- Highcharts -->
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.0/highcharts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.0/highcharts-more.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts@11.4.0/modules/heatmap.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "Mapping Meaning - Building a Semantic Search | Bites | Marco Ruch",
      "description": "Build a semantic search engine from scratch using JavaScript embeddings. Learn how vector databases power modern search through interactive examples.",
      "url": "https://www.marcoruch.ch/bites/mapping-meaning/",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.marcoruch.ch/bites/mapping-meaning/"
      },
      "image": {
        "@type": "ImageObject",
        "url": "https://www.marcoruch.ch/bites/assets/images/mapping-meaning_preview.webp",
        "width": 1200,
        "height": 630
      },
      "datePublished": "2025-10-18T00:00:00Z",
      "dateModified": "2025-10-18T00:00:00Z",
      "author": {
        "@type": "Person",
        "name": "Marco Ruch",
        "url": "https://www.marcoruch.ch/",
        "jobTitle": "Senior Software Engineer",
        "sameAs": [
          "https://www.linkedin.com/in/marco-ruch/",
          "https://github.com/marcoruch/"
        ]
      },
      "publisher": {
        "@type": "Person",
        "name": "Marco Ruch",
        "url": "https://www.marcoruch.ch/"
      },
      "articleSection": "Computer Science",
      "keywords": "semantic search, embeddings, vector database, TF-IDF, natural language processing, search algorithms, machine learning",
      "inLanguage": "en-GB",
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Portfolio",
            "item": "https://www.marcoruch.ch/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Bites",
            "item": "https://www.marcoruch.ch/bites/"
          },
          {
            "@type": "ListItem",
            "position": 3,
            "name": "Mapping Meaning",
            "item": "https://www.marcoruch.ch/bites/mapping-meaning/"
          }
        ]
      },
      "about": [
        {
          "@type": "Thing",
          "name": "Semantic Search"
        },
        {
          "@type": "Thing",
          "name": "Vector Databases"
        },
        {
          "@type": "Thing",
          "name": "Machine Learning"
        }
      ]
    }
    </script>
    
    <style>
        /* ===== Page-Specific Styles for Mapping Meaning ===== */
        
        /* Main Interactive Section */
        .viz-container {
            flex: 1;
            min-height: 700px;
            background: linear-gradient(to bottom, var(--color-off-white), #f5f2ed);
            display: flex;
            flex-direction: column;
        }
        
        .viz-content {
            flex: 1;
            display: flex;
            gap: 2rem;
            padding: 2rem;
            position: relative;
        }
        
        /* Visualization Canvas */
        #canvas-container {
            flex: 1;
            min-width: 0;
            position: relative;
            border-left: 3px solid var(--color-gold);
            box-shadow: var(--shadow-subtle);
            background: white;
            display: flex;
            flex-direction: column;
        }
        
        #vectorSpaceChart {
            flex: 1;
            min-height: 500px;
        }
        
        /* Search Input */
        .search-input-container {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.98);
            border-bottom: 2px solid var(--color-gold-20);
        }
        
        .search-input {
            width: 100%;
            padding: 0.8rem 1rem;
            font-family: var(--font-secondary);
            font-size: 0.95rem;
            border: 2px solid var(--color-deep-blue);
            background: white;
            color: var(--color-deep-blue);
            transition: all var(--transition-normal);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--color-gold);
            box-shadow: 0 0 0 3px var(--color-gold-20);
        }
        
        .search-input:disabled {
            background: #f5f5f5;
            color: #999;
            cursor: not-allowed;
            border-color: #ccc;
        }
        
        .search-input::placeholder {
            color: #999;
        }
        
        /* Results Panel */
        .results-panel {
            background: rgba(255, 255, 255, 0.98);
            padding: 2rem;
            border-top: 3px solid var(--color-gold);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            margin: 0 2rem 2rem 2rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .results-title {
            font-family: var(--font-primary);
            font-size: 1.3rem;
            color: var(--color-deep-blue);
            margin-bottom: 1.5rem;
        }
        
        .result-item {
            background: rgba(16, 33, 75, 0.03);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid transparent;
            transition: all var(--transition-normal);
        }
        
        .result-item:hover {
            background: rgba(215, 189, 136, 0.1);
            border-left-color: var(--color-gold);
            transform: translateX(5px);
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .result-title-text {
            font-weight: 600;
            color: var(--color-deep-blue);
            font-size: 0.95rem;
        }
        
        .similarity-score {
            font-family: var(--font-primary);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-gold);
        }
        
        .result-text {
            font-size: 0.85rem;
            color: #555;
            line-height: 1.6;
        }
        
        .result-category {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            background: var(--color-gold-20);
            color: var(--color-deep-blue);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.5rem;
        }
        
        /* Step-by-step Sections */
        .step-section {
            background: var(--color-off-white);
            padding: 3rem 2rem;
            border-top: 1px solid rgba(16, 33, 75, 0.1);
        }
        
        .step-section:nth-child(even) {
            background: linear-gradient(to bottom, #f5f2ed, var(--color-off-white));
        }
        
        .step-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .step-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        .step-number {
            font-family: var(--font-primary);
            font-size: 1rem;
            color: var(--color-gold);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        
        .step-title {
            font-family: var(--font-primary);
            font-size: 2.5rem;
            color: var(--color-deep-blue);
            margin-bottom: 1rem;
        }
        
        .step-description {
            font-size: 1.05rem;
            color: #555;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        .step-demo {
            background: white;
            padding: 2rem;
            border-left: 3px solid var(--color-gold);
            box-shadow: var(--shadow-subtle);
            margin-top: 2rem;
        }
        
        /* Tokenization Visual */
        .token-visual {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .token {
            background: var(--color-deep-blue);
            color: var(--color-off-white);
            padding: 0.5rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-radius: 4px;
            transition: all var(--transition-fast);
        }
        
        .token:hover {
            background: var(--color-gold);
            color: var(--color-deep-blue);
            transform: translateY(-2px);
        }
        
        /* Vector Visual */
        .vector-display {
            background: rgba(16, 33, 75, 0.05);
            padding: 1.5rem;
            margin-top: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            border-left: 3px solid var(--color-gold);
        }
        
        .vector-dim {
            display: inline-block;
            margin-right: 1rem;
            color: var(--color-deep-blue);
        }
        
        .vector-value {
            color: var(--color-gold);
            font-weight: 700;
        }
        
        /* Similarity Comparison */
        .similarity-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
            margin-top: 2rem;
        }
        
        .comparison-item {
            background: white;
            padding: 1.5rem;
            border-left: 3px solid var(--color-gold);
            box-shadow: var(--shadow-subtle);
        }
        
        .comparison-arrow {
            font-size: 2rem;
            color: var(--color-gold);
            text-align: center;
        }
        
        /* Chart containers */
        .chart-box {
            background: white;
            padding: 2rem;
            border-left: 3px solid var(--color-gold);
            box-shadow: var(--shadow-subtle);
            margin-top: 2rem;
        }
        
        /* Info boxes */
        .info-box-simple {
            background: rgba(215, 189, 136, 0.1);
            border-left: 3px solid var(--color-gold);
            padding: 1rem;
            margin-top: 1.5rem;
        }
        
        .info-box-simple h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--color-deep-blue);
            font-weight: 600;
        }
        
        .info-box-simple p {
            font-size: 0.85rem;
            line-height: 1.6;
            margin: 0;
        }
        
        /* Status indicator */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(215, 189, 136, 0.2);
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 1rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--color-gold);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .viz-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .controls-panel,
            .info-panel {
                width: 100%;
            }
            
            #canvas-container {
                min-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .step-title {
                font-size: 2rem;
            }
            
            .similarity-comparison {
                grid-template-columns: 1fr;
            }
            
            .comparison-arrow {
                transform: rotate(90deg);
            }
            
            .results-panel {
                margin: 0 1rem 1rem 1rem;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <header>
            <div class="header-content">
                <div class="breadcrumb-nav">
                    <a href="../../index.html" class="breadcrumb-link">Portfolio</a>
                    <span class="breadcrumb-separator">/</span>
                    <a href="../index.html" class="breadcrumb-link">Bites</a>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-current">Mapping Meaning</span>
                </div>
                <h1>Mapping Meaning</h1>
                <p class="subtitle">Build a semantic search engine from scratch and discover how embeddings transform words into meaning you can measure.</p>
            </div>
        </header>
        
        <main>
            <!-- Main Interactive Visualization -->
            
            <!-- Step 1: Tokenization -->
            <section class="step-section">
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">Step 1</div>
                        <h2 class="step-title">From Text to Tokens</h2>
                        <p class="step-description">
                            Before we can search, we need to break text into pieces computers can understand. This process, called tokenization, splits sentences into words and normalizes them.
                        </p>
                    </div>
                    
                    <div class="step-demo">
                        <h4 style="font-size: 1rem; margin-bottom: 1rem; color: var(--color-deep-blue);">Example: Tokenizing a Document</h4>
                        <p style="font-size: 0.95rem; color: #555; margin-bottom: 1rem;">
                            <strong>Input:</strong> "The elephant is a large mammal with a distinctive trunk"
                        </p>
                        <div class="token-visual" id="tokenExample">
                            <div class="loading-spinner"></div>
                        </div>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 1rem; font-style: italic;">
                            Notice: words are lowercased and common stop words (like "the", "a", "is") are removed to focus on meaningful terms.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- Step 2: Embeddings -->
            <section class="step-section">
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">Step 2</div>
                        <h2 class="step-title">Tokens to Vectors</h2>
                        <p class="step-description">
                            Each document becomes a vector of numbers using TF-IDF (Term Frequency-Inverse Document Frequency). Words that are common in a document but rare across all documents get higher scores.
                        </p>
                    </div>
                    
                    <div class="step-demo">
                        <h4 style="font-size: 1rem; margin-bottom: 1rem; color: var(--color-deep-blue);">TF-IDF Vector Representation</h4>
                        <p style="font-size: 0.9rem; color: #555; margin-bottom: 1rem;">
                            Each dimension represents a word from our vocabulary. The value shows how important that word is to this document.
                        </p>
                        <div class="chart-box">
                            <div id="tfidfChart" style="height: 300px;">
                                
                            <div class="loading-spinner"></div>
                            </div>
                        </div>
                        <div class="info-box-simple" style="margin-top: 1.5rem;">
                            <h4>The Math Behind TF-IDF</h4>
                            <p>
                                <strong>TF (Term Frequency):</strong> How often a word appears in the document<br>
                                <strong>IDF (Inverse Document Frequency):</strong> How unique the word is across all documents<br>
                                <strong>TF-IDF = TF Ã— IDF:</strong> Balance between frequency and uniqueness
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Step 3: Similarity -->
            <section class="step-section">
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">Step 3</div>
                        <h2 class="step-title">Finding Similarity</h2>
                        <p class="step-description">
                            To find similar documents, we calculate the angle between vectors using cosine similarity. A score of 1.0 means identical, 0.0 means completely different.
                        </p>
                    </div>
                    
                    <div class="step-demo">
                        <h4 style="font-size: 1rem; margin-bottom: 1rem; color: var(--color-deep-blue);">Cosine Similarity in Action</h4>
                        <div class="similarity-comparison">
                            <div class="comparison-item">
                                <h5 style="font-family: var(--font-primary); color: var(--color-deep-blue); margin-bottom: 0.5rem;">Query Vector</h5>
                                <p style="font-size: 0.85rem; color: #555; margin-bottom: 1rem;">"intelligent marine animal"</p>
                                <div style="font-family: 'Courier New', monospace; font-size: 0.75rem; color: var(--color-deep-blue);">
                                    [0.52, 0.31, 0.76, 0.18, ...]
                                </div>
                            </div>
                            <div class="comparison-arrow">
                                âŸ¹
                            </div>
                            <div class="comparison-item">
                                <h5 style="font-family: var(--font-primary); color: var(--color-deep-blue); margin-bottom: 0.5rem;">Document Vector</h5>
                                <p style="font-size: 0.85rem; color: #555; margin-bottom: 1rem;">"Dolphins are intelligent marine mammals"</p>
                                <div style="font-family: 'Courier New', monospace; font-size: 0.75rem; color: var(--color-deep-blue);">
                                    [0.48, 0.29, 0.81, 0.22, ...]
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <div style="font-family: var(--font-primary); font-size: 2.5rem; color: var(--color-gold); font-weight: 700;">
                                Similarity: 0.87
                            </div>
                            <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">High similarity indicates these texts share similar meaning</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Step 4: Search -->
            <section class="step-section">
                <div class="step-container">
                    <div class="step-header">
                        <div class="step-number">Step 4</div>
                        <h2 class="step-title">Search in Action</h2>
                        <p class="step-description">
                            Putting it all together: your query is tokenized, vectorized, and compared against all documents. The closest matches appear at the top.
                        </p>
                    </div>
                    
                    <div class="step-demo">
                        <h4 style="font-size: 1rem; margin-bottom: 1rem; color: var(--color-deep-blue);">Try Different Queries</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                            <button class="btn btn-secondary example-query" data-query="intelligent marine mammal echolocation communication">Smart sea creature</button>
                            <button class="btn btn-secondary example-query" data-query="fermented probiotic vegetables spicy Korean tradition">Fermented food culture</button>
                            <button class="btn btn-secondary example-query" data-query="polyrhythmic percussion African grooves extended jams">African rhythm music</button>
                            <button class="btn btn-secondary example-query" data-query="geothermal volcanic renewable energy island Nordic">Volcanic island nation</button>
                            <button class="btn btn-secondary example-query" data-query="distributed decentralized consensus blockchain cryptographic">Decentralized systems</button>
                            <button class="btn btn-secondary example-query" data-query="endurance cardiovascular suffering mental fortitude marathon">Extreme endurance race</button>
                            <button class="btn btn-secondary example-query" data-query="Mediterranean coastal olive wine architecture ancient ruins">Mediterranean culture</button>
                            <button class="btn btn-secondary example-query" data-query="microservice container orchestration scaling cloud-native">Modern architecture</button>
                            <button class="btn btn-secondary example-query" data-query="syncopated rhythmic bass groove dancing funk soul">Groove-based music</button>
                            <button class="btn btn-secondary example-query" data-query="explosive speed sprinting acceleration burst">Fastest animals & sports</button>
                            <button class="btn btn-secondary example-query" data-query="consciousness philosophical mind subjective experience awareness">Philosophy of mind</button>
                            <button class="btn btn-secondary example-query" data-query="layered baked cheese pasta Italian comfort">Italian comfort food</button>
                            <button class="btn btn-secondary example-query" data-query="improvisation spontaneous jazz bebop harmonic complexity">Complex jazz</button>
                            <button class="btn btn-secondary example-query" data-query="grappling submission ground fighting technique leverage">Grappling martial arts</button>
                            <button class="btn btn-secondary example-query" data-query="natural fermentation wild yeast sourdough artisanal">Traditional bread</button>
                            <button class="btn btn-secondary example-query" data-query="social carnivore pack hunting cooperation canine">Pack hunters</button>
                            <button class="btn btn-secondary example-query" data-query="electronic synthesizer repetitive hypnotic dance club">Electronic dance</button>
                            <button class="btn btn-secondary example-query" data-query="philosophical skepticism epistemology knowledge certainty truth">Theory of knowledge</button>
                        </div>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 1.5rem; font-style: italic;">
                            Notice how semantic search finds relevant results even when exact words don't match!
                        </p>
                    </div>
                </div>
            </section>

            
            <div class="viz-container">
                <div class="viz-content">
                    <!-- Left Panel: Info -->
                    <div class="info-panel">
                        <h3 class="info-title">Semantic Search Engine</h3>
                        <p class="info-text">Type a query to search through our knowledge base. The engine converts your text to a vector and finds the most similar documents using cosine similarity.</p>
                        
                        <div class="legend">
                            <h4 class="legend-title">Vector Space</h4>
                            <div class="legend-item">
                                <div class="legend-icon">
                                    <div class="legend-node" style="background: var(--color-gold);"></div>
                                </div>
                                <span class="legend-text">Your Query</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon">
                                    <div class="legend-node" style="background: var(--color-deep-blue);"></div>
                                </div>
                                <span class="legend-text">Documents</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon">
                                    <div class="legend-node" style="background: var(--color-dust);"></div>
                                </div>
                                <span class="legend-text">Top Match</span>
                            </div>
                        </div>
                        
                        <div class="info-box-simple">
                            <h4>How It Works</h4>
                            <p>Each document and query is converted to a TF-IDF vector. The bar chart shows similarity scores ranking the most semantically related documents.</p>
                        </div>
                        
                        <div class="info-box-simple" style="margin-top: 1rem;">
                            <h4>Visualization</h4>
                            <p style="font-size: 0.8rem; line-height: 1.5;">
                                <strong>ðŸ“ˆ Bars:</strong> Top results ranked by similarity score with clear percentages showing semantic match strength
                            </p>
                        </div>
                        
                        <div class="status-indicator" id="statusIndicator">
                            <div class="status-dot"></div>
                            <span id="statusText">Initializing...</span>
                        </div>
                        
                        <div id="loadingProgress" style="margin-top: 1rem; display: none;">
                            <div style="background: rgba(16, 33, 75, 0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                                <div id="progressBar" style="background: linear-gradient(to right, var(--color-deep-blue), var(--color-gold)); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                            </div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.5rem; text-align: center;" id="progressText">0%</div>
                        </div>
                    </div>
                    
                    <!-- Center: Visualization -->
                    <div id="canvas-container">
                        <div class="search-input-container">
                            <input type="text" 
                                   id="searchInput" 
                                   class="search-input" 
                                   placeholder="Try: 'intelligent sea creatures', 'Italian pasta', 'jazz music', 'ice sport', or 'software containers'">
                        </div>
                        <div id="vectorSpaceChart">
                            
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                    
                    <!-- Right Panel: Controls -->
                    <div class="controls-panel">
                        <h3 class="controls-title">Dataset & Filters</h3>
                        <p class="info-text">Explore different categories or view all documents in the knowledge base.</p>
                        
                        <div class="control-group first-control">
                            <label>Category Filter</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="category" value="all" checked>
                                    <span class="radio-label">All (<span id="countAll">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="animals">
                                    <span class="radio-label">Animals (<span id="countAnimals">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="countries">
                                    <span class="radio-label">Countries (<span id="countCountries">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="coffee">
                                    <span class="radio-label">Coffee (<span id="countCoffee">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="concepts">
                                    <span class="radio-label">Concepts (<span id="countConcepts">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="technology">
                                    <span class="radio-label">Technology (<span id="countTechnology">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="foods">
                                    <span class="radio-label">Foods (<span id="countFoods">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="music">
                                    <span class="radio-label">Music (<span id="countMusic">0</span>)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="category" value="sports">
                                    <span class="radio-label">Sports (<span id="countSports">0</span>)</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label>Visualization Mode</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="vizMode" value="bars" checked>
                                    <span class="radio-label">ðŸ“ˆ Bars</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label>Display</label>
                            <button class="btn btn-secondary" id="resetBtn">Reset View</button>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom: Results Panel -->
                <div class="results-panel" id="resultsPanel" style="display: none;">
                    <h3 class="results-title">Search Results</h3>
                    <div id="resultsList"></div>
                </div>
            </div>
        </main>
        
        <!-- Explanation Section -->
        <section class="explanation">
            <div class="explanation-content">
                <h2 class="section-header">Understanding Semantic Search</h2>
                <p class="section-intro">
                    Traditional search engines match keywords. Semantic search understands meaning. When you search for "intelligent ocean animals," a keyword search might miss "Dolphins are smart marine mammals" because the exact words don't match. Semantic search finds it because the meaning is similar.
                </p>
                
                <blockquote class="highlight-quote">
                    The breakthrough insight: <strong>if we can represent text as numbers, we can measure similarity mathematically</strong>. Words with similar meanings should have similar numerical representations. This is the foundation of embeddings â€” transforming language into geometry where proximity equals semantic similarity.
                </blockquote>
                
                <h3 class="section-header">How Embeddings Work</h3>
                
                <div class="flowing-explanation">
                    <p>An embedding is a transformation from words to vectors â€” lists of numbers. But not just any numbers. The key is that similar words end up close together in this vector space, while different words stay far apart.</p>
                    
                    <p><strong>TF-IDF Embeddings:</strong> Our implementation uses Term Frequency-Inverse Document Frequency, a classic technique from information retrieval. For each word, we calculate two things:</p>
                    
                    <p><strong>1. Term Frequency (TF):</strong> How often does this word appear in the document? Common words like "the" appear frequently, but so do important topic words like "elephant" in a document about elephants.</p>
                    
                    <p><strong>2. Inverse Document Frequency (IDF):</strong> How rare is this word across all documents? Words that appear in every document (like "the") aren't very informative. Rare words (like "espresso" in a coffee context) tell us a lot about what makes a document unique.</p>
                    
                    <p>The TF-IDF score multiplies these together: <em>TF Ã— IDF = (word count / total words) Ã— log(total docs / docs with word)</em>. This balances local importance (TF) with global uniqueness (IDF).</p>
                </div>
                
                <h3 class="section-header">Measuring Similarity</h3>
                
                <div class="flowing-explanation">
                    <p>Once we have vectors, we need to measure how similar they are. Cosine similarity is perfect for this. Instead of measuring straight-line distance, it measures the angle between vectors.</p>
                    
                    <p>Why angles instead of distance? Imagine two documents about elephants â€” one is a short definition, the other a detailed encyclopedia entry. They have very different vector lengths (magnitudes), but they point in the same direction (similar word distributions). Cosine similarity captures this: it returns 1.0 for identical directions, 0.0 for perpendicular (unrelated), and -1.0 for opposite directions.</p>
                    
                    <p>The formula: <em>cosine(A, B) = (A Â· B) / (||A|| Ã— ||B||)</em>, where A Â· B is the dot product and ||A|| is the magnitude. In practice, this means: multiply matching dimensions, sum them up, and normalize by vector lengths.</p>
                </div>
                
                <h3 class="section-header">Real-World Applications</h3>
                
                <div class="explanation-grid">
                    <div class="explanation-card">
                        <h3>Search Engines</h3>
                        <p>Google and other search engines use embeddings to understand query intent. When you search "how to fix leaky faucet," they understand you're looking for repair guides, even if pages use words like "dripping tap" or "plumbing solutions."</p>
                    </div>
                    
                    <div class="explanation-card">
                        <h3>Recommendation Systems</h3>
                        <p>Netflix, Spotify, and Amazon embed products, movies, and songs as vectors. Similar embeddings mean similar content. This powers "you might also like" features that find connections humans might miss.</p>
                    </div>
                    
                    <div class="explanation-card">
                        <h3>Vector Databases</h3>
                        <p>Modern databases like Pinecone, Weaviate, and Milvus are built specifically for storing and searching embeddings. They enable fast similarity search across millions of vectors for applications like RAG (Retrieval-Augmented Generation) with AI.</p>
                    </div>
                    
                    <div class="explanation-card">
                        <h3>Document Clustering</h3>
                        <p>News aggregators group similar articles automatically by clustering their embeddings. No manual categorization needed â€” the vectors naturally cluster by topic.</p>
                    </div>
                    
                    <div class="explanation-card">
                        <h3>Semantic Deduplication</h3>
                        <p>Find duplicate or near-duplicate content even when wording differs. Essential for cleaning datasets, detecting plagiarism, or managing large document repositories.</p>
                    </div>
                    
                    <div class="explanation-card">
                        <h3>Question Answering</h3>
                        <p>AI assistants like ChatGPT use embeddings to find relevant context from knowledge bases. Your question is embedded, matched against document embeddings, and the most relevant passages are retrieved to answer your query.</p>
                    </div>
                </div>
                
                <h3 class="section-header">Beyond TF-IDF</h3>
                
                <div class="flowing-explanation">
                    <p>While TF-IDF works well for many tasks, modern systems use neural embeddings that capture deeper semantic relationships:</p>
                    
                    <p><strong>Word2Vec and GloVe:</strong> These models learn word embeddings from massive text corpora. They famously capture analogies: <em>king - man + woman â‰ˆ queen</em>. The vectors encode semantic relationships learned from patterns of word co-occurrence.</p>
                    
                    <p><strong>Sentence Transformers:</strong> Models like BERT and its variants create embeddings for entire sentences. They understand context â€” "bank" near "river" gets a different embedding than "bank" near "money."</p>
                    
                    <p><strong>Multi-modal Embeddings:</strong> CLIP and similar models embed both images and text into the same vector space. Search images with text queries, or text with image queries. The same similarity math works across modalities.</p>
                    
                    <p>The principle remains the same across all these approaches: <strong>transform data into vectors where geometric proximity represents semantic similarity</strong>. Whether you're using TF-IDF, transformers, or custom neural networks, you're mapping meaning into measurable mathematics.</p>
                </div>
                
                <div class="info-box">
                    <h3 class="section-header">Implementation Notes</h3>
                    <p>This demonstration implements semantic search entirely in JavaScript with no external ML libraries. The TF-IDF vectorizer builds a vocabulary from the corpus, calculates term frequencies and inverse document frequencies, and transforms text into sparse vectors.</p>
                    <p>For production systems, you'd typically use:</p>
                    <ul>
                        <li><strong>Pre-trained models:</strong> Sentence-BERT, OpenAI embeddings, or domain-specific models</li>
                        <li><strong>Specialized databases:</strong> Vector databases optimized for similarity search at scale</li>
                        <li><strong>Approximate nearest neighbors:</strong> Algorithms like HNSW or IVF for sub-linear search time</li>
                        <li><strong>Dimensionality reduction:</strong> PCA or UMAP to reduce vector size while preserving relationships</li>
                    </ul>
                    <p>But the core concept â€” embeddings enabling semantic search through similarity metrics â€” remains the same regardless of implementation complexity.</p>
                </div>
                
                <div class="technical-note">
                    <h4>References & Further Reading</h4>
                    <p>
                        For the mathematics of TF-IDF: <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf" target="_blank" rel="noopener noreferrer" style="color: var(--color-gold); text-decoration: underline;">TF-IDF on Wikipedia</a>. For modern embedding techniques: <a href="https://www.sbert.net/" target="_blank" rel="noopener noreferrer" style="color: var(--color-gold); text-decoration: underline;">Sentence-BERT</a> and the paper "Attention Is All You Need" by Vaswani et al. For vector databases: <a href="https://www.pinecone.io/learn/vector-database/" target="_blank" rel="noopener noreferrer" style="color: var(--color-gold); text-decoration: underline;">Pinecone's Vector Database Guide</a>.
                    </p>
                </div>
            </div>
        </section>
    </div>
    
    <script>
        // ===== Embedding Model Implementation =====
        
        class Tokenizer {
            constructor() {
                this.stopWords = new Set([
                    // Articles, prepositions, conjunctions
                    'a', 'an', 'and', 'the', 'of', 'to', 'in', 'on', 'for', 'by', 'from', 'with', 'as',
                    'at', 'about', 'against', 'between', 'into', 'through', 'during', 'before', 'after',
                    'above', 'below', 'under', 'over', 'around', 'near', 'across', 'behind', 'beyond',
                    'toward', 'towards', 'via',

                    // Pronouns
                    'i', 'me', 'my', 'myself', 'we', 'our', 'ours', 'ourselves',
                    'you', 'your', 'yours', 'yourself', 'yourselves',
                    'he', 'him', 'his', 'himself', 'she', 'her', 'hers', 'herself',
                    'it', 'its', 'itself', 'they', 'them', 'their', 'theirs', 'themselves',
                    'one', 'ones', 'someone', 'something', 'anyone', 'anything', 'everyone', 'everything',

                    // Auxiliary & modal verbs
                    'am', 'is', 'are', 'was', 'were', 'be', 'been', 'being',
                    'have', 'has', 'had', 'having', 'do', 'does', 'did', 'doing',
                    'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must',

                    // Negations and contractions
                    'not', 'no', 'nor', "isn't", "aren't", "wasn't", "weren't", "haven't", "hasn't",
                    "hadn't", "won't", "wouldn't", "shan't", "shouldn't", "can't", "cannot",
                    "couldn't", "mustn't", "don't", "doesn't", "didn't", "mightn't", "needn't",

                    // Adverbs, intensifiers, fillers
                    'very', 'really', 'quite', 'just', 'only', 'even', 'still', 'also', 'however', 'though',
                    'too', 'enough', 'almost', 'rather', 'somewhat', 'perhaps', 'maybe', 'often',
                    'usually', 'sometimes', 'always', 'never', 'ever', 'therefore', 'thus', 'yet',
                    'so', 'such', 'again', 'already', 'then', 'once',

                    // Determiners & quantifiers
                    'this', 'that', 'these', 'those', 'each', 'every', 'either', 'neither', 'both',
                    'few', 'many', 'more', 'most', 'much', 'less', 'least', 'lot', 'lots', 'plenty',
                    'some', 'any', 'all', 'several', 'enough',

                    // Relatives, question words, connectors
                    'what', 'which', 'who', 'whom', 'whose', 'where', 'when', 'why', 'how', 'while',
                    'because', 'since', 'until', 'unless', 'whether', 'although', 'though', 'whereas',

                    // Filler phrases (common in descriptive text)
                    'including', 'such', 'example', 'especially', 'typically', 'mainly', 'generally',
                    'usually', 'commonly', 'often', 'mostly', 'sometimes', 'among', 'throughout',
                    'consists', 'consist', 'contains', 'contain', 'composed', 'made', 'known', 'called',

                    // Textual noise words (Wikipedia-style)
                    'used', 'using', 'use', 'found', 'founder', 'founding',
                    'based', 'located', 'include', 'includes', 'included', 'known', 'knowns', 'knowns',
                    'form', 'forms', 'forming', 'formed', 'make', 'makes', 'making', 'made',
                    'type', 'types', 'kind', 'kinds', 'group', 'groups', 'species', 'animal', 'animals',
                    'living', 'life', 'world', 'earth', 'known', 'called', 'known', 'example', 'examples',

                    // Generic descriptive words (neutral in meaning)
                    'large', 'small', 'big', 'great', 'different', 'various', 'common', 'unique',
                    'several', 'other', 'similar', 'many', 'much', 'numerous', 'few', 'another',

                    // Miscellaneous
                    'etc', 'e.g.', 'i.e.', 'etc.', 'also', 'often', 'usually', 'sometimes', 'mainly',
                    'mostly', 'rather', 'perhaps', 'among', 'across', 'throughout', 'through',
                    'based', 'around', 'within'
                    ]);
            }
            
            tokenize(text) {
                // Convert to lowercase and split into words
                const words = text.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')  // Remove punctuation
                    .split(/\s+/)
                    .filter(word => word.length > 0);
                
                // Remove stop words
                return words.filter(word => !this.stopWords.has(word));
            }
        }
        
        class TFIDFVectorizer {
            constructor() {
                this.vocabulary = [];
                this.idf = {};
                this.documents = [];
            }
            
            fit(documents) {
                this.documents = documents;
                const tokenizer = new Tokenizer();
                
                // Build vocabulary
                const wordSet = new Set();
                const tokenizedDocs = documents.map(doc => {
                    const tokens = tokenizer.tokenize(doc);
                    tokens.forEach(token => wordSet.add(token));
                    return tokens;
                });
                
                this.vocabulary = Array.from(wordSet).sort();
                
                // Calculate IDF for each word
                const docCount = documents.length;
                this.vocabulary.forEach(word => {
                    const docsWithWord = tokenizedDocs.filter(tokens => 
                        tokens.includes(word)
                    ).length;
                    this.idf[word] = Math.log(docCount / (docsWithWord + 1)) + 1;
                });
                
                return this;
            }
            
            transform(text) {
                const tokenizer = new Tokenizer();
                const tokens = tokenizer.tokenize(text);
                
                // Calculate term frequency
                const tf = {};
                tokens.forEach(token => {
                    tf[token] = (tf[token] || 0) + 1;
                });
                
                // Normalize TF
                const totalTerms = tokens.length || 1;
                Object.keys(tf).forEach(token => {
                    tf[token] = tf[token] / totalTerms;
                });
                
                // Create TF-IDF vector
                const vector = new Array(this.vocabulary.length).fill(0);
                this.vocabulary.forEach((word, idx) => {
                    if (tf[word]) {
                        vector[idx] = tf[word] * (this.idf[word] || 0);
                    }
                });
                
                return vector;
            }
            
            fitTransform(documents) {
                this.fit(documents);
                return documents.map(doc => this.transform(doc));
            }
        }
        
        class SimilarityCalculator {
            static cosineSimilarity(vec1, vec2) {
                if (vec1.length !== vec2.length) {
                    throw new Error('Vectors must have same length');
                }
                
                let dotProduct = 0;
                let norm1 = 0;
                let norm2 = 0;
                
                for (let i = 0; i < vec1.length; i++) {
                    dotProduct += vec1[i] * vec2[i];
                    norm1 += vec1[i] * vec1[i];
                    norm2 += vec2[i] * vec2[i];
                }
                
                norm1 = Math.sqrt(norm1);
                norm2 = Math.sqrt(norm2);
                
                if (norm1 === 0 || norm2 === 0) return 0;
                
                return dotProduct / (norm1 * norm2);
            }
        }
        
        // ===== Semantic Search Engine =====
        
        class SemanticSearchEngine {
            constructor(knowledgeBase) {
                this.knowledgeBase = knowledgeBase;
                this.vectorizer = new TFIDFVectorizer();
                this.documentVectors = [];
                this.isReady = false;
            }
            
            async initialize(progressCallback) {
                const texts = this.knowledgeBase.map(item => `${item.category} ${item.title} ${item.text}`);
                
                // Step 1: Build vocabulary (fast, ~50ms)
                this.vectorizer.fit(texts);
                
                // Step 2: Transform documents in batches (category by category)
                const batchSize = 80; // One category at a time
                const categoryNames = ['Animals', 'Countries', 'Coffee', 'Concepts', 'Technology', 'Foods', 'Music', 'Sports'];
                
                for (let i = 0; i < texts.length; i += batchSize) {
                    const batch = texts.slice(i, i + batchSize);
                    
                    // Transform batch
                    const batchVectors = batch.map(text => this.vectorizer.transform(text));
                    this.documentVectors.push(...batchVectors);
                    
                    // Report progress
                    const progress = Math.min(100, Math.round(((i + batchSize) / texts.length) * 100));
                    const categoryIndex = Math.floor(i / batchSize);
                    const categoryName = categoryNames[categoryIndex] || 'Final';
                    
                    if (progressCallback) {
                        progressCallback(progress, categoryName);
                    }
                    
                    // Yield to browser for UI updates
                    await new Promise(resolve => setTimeout(resolve, 0));
                }
                
                this.isReady = true;
            }
            
            search(query, topK = 5, categoryFilter = 'all') {
                const queryVector = this.vectorizer.transform(query);
                
                // Calculate similarities
                const results = this.knowledgeBase.map((item, idx) => {
                    const similarity = SimilarityCalculator.cosineSimilarity(
                        queryVector,
                        this.documentVectors[idx]
                    );
                    return { ...item, similarity, vector: this.documentVectors[idx] };
                });
                
                // Filter by category if needed
                let filtered = results;
                if (categoryFilter !== 'all') {
                    filtered = results.filter(r => r.category === categoryFilter);
                }
                
                // Sort by similarity and return top K
                return filtered
                    .sort((a, b) => b.similarity - a.similarity)
                    .slice(0, topK);
            }
            
            getVectorDimensions() {
                return this.vectorizer.vocabulary.length;
            }
            
            getAllDocuments(categoryFilter = 'all') {
                if (categoryFilter === 'all') {
                    return this.knowledgeBase.map((item, idx) => ({
                        ...item,
                        vector: this.documentVectors[idx]
                    }));
                }
                return this.knowledgeBase
                    .map((item, idx) => ({
                        ...item,
                        vector: this.documentVectors[idx]
                    }))
                    .filter(item => item.category === categoryFilter);
            }
        }
        
        // ===== Dimensionality Reduction for Visualization =====
        
        class PCAReducer {
            static reduce2D(vectors) {
                if (vectors.length === 0) return [];
                
                // Simple PCA: find top 2 dimensions with highest variance
                const dims = vectors[0].length;
                const variances = [];
                
                for (let d = 0; d < dims; d++) {
                    const values = vectors.map(v => v[d]);
                    const mean = values.reduce((a, b) => a + b, 0) / values.length;
                    const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
                    variances.push({ dim: d, variance });
                }
                
                // Sort by variance and take top 2
                variances.sort((a, b) => b.variance - a.variance);
                const topDims = variances.slice(0, 2).map(v => v.dim);
                
                // Project to 2D
                return vectors.map(vec => [vec[topDims[0]], vec[topDims[1]]]);
            }
        }
        
        // ===== Knowledge Base Dataset =====
        // Total: 640 items across 8 categories (80 items each)
        async function loadKnowledgeBase() {
            const response = await fetch('data/knowledge-base.json');
            const knowledgeBase = await response.json();
            return knowledgeBase;
        }

        // ===== Visualization =====
        
        let searchEngine;
        let currentCategory = 'all';
        let currentVizMode = 'bars';
        let vectorSpaceChart;
        let currentQueryVector = null;
        let currentTopResults = [];
        
        async function initializeApp() {
            const knowledgeBase = await loadKnowledgeBase();
            // Show loading state
            const statusText = document.getElementById('statusText');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const loadingProgress = document.getElementById('loadingProgress');
            const searchInput = document.getElementById('searchInput');
            
            // Disable search initially
            searchInput.disabled = true;
            searchInput.placeholder = 'Loading semantic search engine...';
            
            // Show progress bar
            loadingProgress.style.display = 'block';
            
            // Create search engine
            searchEngine = new SemanticSearchEngine(knowledgeBase);
            
            // Initialize with progress callback
            await searchEngine.initialize((progress, categoryName) => {
                statusText.textContent = `Processing ${categoryName}...`;
                progressBar.style.width = progress + '%';
                progressText.textContent = `${progress}% (${categoryName})`;
            });
            
            // Hide progress, show ready state
            loadingProgress.style.display = 'none';
            statusText.textContent = 'Model Ready';
            searchInput.disabled = false;
            searchInput.placeholder = "Try: 'intelligent sea creatures', 'Italian pasta', 'jazz music', 'ice sport', or 'software containers'";
            
            // Update counts
            updateCategoryCounts();
            
            // Initialize visualization
            renderVectorSpace();
            
            // Show tokenization example
            showTokenizationExample();
            
            // Show TF-IDF chart
            showTFIDFChart();
            
            // Event listeners
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300);
            });
            
            // Category filters
            document.querySelectorAll('input[name="category"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    currentCategory = e.target.value;
                    renderVectorSpace(currentQueryVector, currentTopResults);
                    const query = searchInput.value;
                    if (query) performSearch(query);
                });
            });
            
            // Visualization mode selector
            document.querySelectorAll('input[name="vizMode"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    currentVizMode = e.target.value;
                    renderVectorSpace(currentQueryVector, currentTopResults);
                });
            });
            
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', () => {
                searchInput.value = '';
                currentQueryVector = null;
                currentTopResults = [];
                document.getElementById('resultsPanel').style.display = 'none';
                renderVectorSpace();
            });
            
            // Example query buttons
            document.querySelectorAll('.example-query').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const query = e.target.dataset.query;
                    searchInput.value = query;
                    performSearch(query);
                    const vizContainer = document.getElementsByClassName('viz-container')[0];
                    window.scrollTo({
                        top: vizContainer.offsetTop,
                        behavior: 'smooth'
                    });
                });
            });
        }
        
        function updateCategoryCounts() {
            const counts = {
                all: knowledgeBase.length,
                animals: knowledgeBase.filter(i => i.category === 'animals').length,
                countries: knowledgeBase.filter(i => i.category === 'countries').length,
                coffee: knowledgeBase.filter(i => i.category === 'coffee').length,
                concepts: knowledgeBase.filter(i => i.category === 'concepts').length,
                technology: knowledgeBase.filter(i => i.category === 'technology').length,
                foods: knowledgeBase.filter(i => i.category === 'foods').length,
                music: knowledgeBase.filter(i => i.category === 'music').length,
                sports: knowledgeBase.filter(i => i.category === 'sports').length,
            };
            
            document.getElementById('countAll').textContent = counts.all;
            document.getElementById('countAnimals').textContent = counts.animals;
            document.getElementById('countCountries').textContent = counts.countries;
            document.getElementById('countCoffee').textContent = counts.coffee;
            document.getElementById('countConcepts').textContent = counts.concepts;
            document.getElementById('countTechnology').textContent = counts.technology;
            document.getElementById('countFoods').textContent = counts.foods;
            document.getElementById('countMusic').textContent = counts.music;
            document.getElementById('countSports').textContent = counts.sports;
        }
        
        function renderVectorSpace(queryVector = null, topResults = []) {
            // Check if model is ready
            if (!searchEngine || !searchEngine.isReady) {
                // Show placeholder
                if (vectorSpaceChart) {
                    vectorSpaceChart.destroy();
                }
                vectorSpaceChart = Highcharts.chart('vectorSpaceChart', {
                    chart: { backgroundColor: 'transparent' },
                    title: {
                        text: 'Loading Vector Space...',
                        style: {
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '1.3rem',
                            color: '#10214b',
                            fontWeight: '700'
                        }
                    },
                    subtitle: {
                        text: 'Initializing semantic search engine',
                        style: {
                            fontFamily: "'Montserrat', sans-serif",
                            fontSize: '0.9rem',
                            color: '#666'
                        }
                    },
                    credits: { enabled: false },
                    xAxis: { visible: false },
                    yAxis: { visible: false },
                    series: []
                });
                return;
            }
            
            // Route to appropriate visualization based on mode
            switch(currentVizMode) {
                case 'bars':
                    renderBarsVisualization(queryVector, topResults);
                    break;
                default:
                    renderBarsVisualization(queryVector, topResults);
            }
        }
        
        // === BARS VISUALIZATION ===
        function renderBarsVisualization(queryVector = null, topResults = []) {
            const documents = searchEngine.getAllDocuments(currentCategory);
            
            if (vectorSpaceChart) {
                vectorSpaceChart.destroy();
            }
            
            if (!queryVector || topResults.length === 0) {
                // Show message when no query
                vectorSpaceChart = Highcharts.chart('vectorSpaceChart', {
                    chart: {
                        backgroundColor: 'transparent'
                    },
                    title: {
                        text: 'Similarity Ranking',
                        style: {
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '1.3rem',
                            color: '#10214b',
                            fontWeight: '700'
                        }
                    },
                    subtitle: {
                        text: 'Enter a search query to see similarity scores',
                        style: {
                            fontFamily: "'Montserrat', sans-serif",
                            fontSize: '1rem',
                            color: '#666',
                            marginTop: '100px'
                        },
                        verticalAlign: 'middle',
                        y: 0
                    },
                    credits: { enabled: false },
                    xAxis: { visible: false },
                    yAxis: { visible: false },
                    series: []
                });
            } else {
                // Show top 10 results as horizontal bars
                const top10 = topResults.slice(0, 10);
                const categories = top10.map(r => r.title).reverse();
                const data = top10.map(r => ({
                    y: r.similarity * 100,
                    color: r.similarity > 0.5 ? '#d7bd88' : '#10214b'
                })).reverse();
                
                vectorSpaceChart = Highcharts.chart('vectorSpaceChart', {
                    chart: {
                        type: 'bar',
                        backgroundColor: 'transparent'
                    },
                    title: {
                        text: 'Semantic Similarity Scores',
                        style: {
                            fontFamily: "'Playfair Display', serif",
                            fontSize: '1.3rem',
                            color: '#10214b',
                            fontWeight: '700'
                        }
                    },
                    subtitle: {
                        text: 'Top 10 most similar documents',
                        style: {
                            fontFamily: "'Montserrat', sans-serif",
                            fontSize: '0.85rem',
                            color: '#666'
                        }
                    },
                    credits: { enabled: false },
                    xAxis: {
                        categories: categories,
                        title: { text: null },
                        labels: {
                            style: {
                                fontFamily: "'Montserrat', sans-serif",
                                fontSize: '0.85rem'
                            }
                        }
                    },
                    yAxis: {
                        min: 0,
                        max: 100,
                        title: {
                            text: 'Similarity (%)',
                            align: 'high'
                        },
                        labels: {
                            overflow: 'justify',
                            formatter: function() {
                                return this.value + '%';
                            }
                        }
                    },
                    tooltip: {
                        valueSuffix: '%',
                        formatter: function() {
                            return `<b>${this.x}</b><br/>Similarity: ${this.y.toFixed(1)}%`;
                        }
                    },
                    plotOptions: {
                        bar: {
                            dataLabels: {
                                enabled: true,
                                formatter: function() {
                                    return this.y.toFixed(1) + '%';
                                },
                                style: {
                                    fontWeight: 'bold',
                                    color: '#10214b'
                                }
                            }
                        }
                    },
                    legend: { enabled: false },
                    series: [{
                        name: 'Similarity',
                        data: data
                    }]
                });
            }
        }
        
        function performSearch(query) {
            // Check if model is ready
            if (!searchEngine || !searchEngine.isReady) {
                return;
            }
            
            if (!query.trim()) {
                currentQueryVector = null;
                currentTopResults = [];
                document.getElementById('resultsPanel').style.display = 'none';
                renderVectorSpace();
                return;
            }
            
            const results = searchEngine.search(query, 10, currentCategory); // Get top 10 for bars view
            const queryVector = searchEngine.vectorizer.transform(query);
            
            // Store current state
            currentQueryVector = queryVector;
            currentTopResults = results;
            
            // Update visualization
            renderVectorSpace(queryVector, results);
            
            // Display results (top 5 in panel)
            displayResults(results.slice(0, 5));
        }
        
        function displayResults(results) {
            const resultsPanel = document.getElementById('resultsPanel');
            const resultsList = document.getElementById('resultsList');
            
            if (results.length === 0) {
                resultsPanel.style.display = 'none';
                return;
            }
            
            resultsPanel.style.display = 'block';
            
            resultsList.innerHTML = results.map(result => `
                <div class="result-item">
                    <div class="result-header">
                        <span class="result-title-text">${result.title}</span>
                        <span class="similarity-score">${(result.similarity * 100).toFixed(1)}%</span>
                    </div>
                    <p class="result-text">${result.text}</p>
                    <span class="result-category">${result.category}</span>
                </div>
            `).join('');
        }
        
        function showTokenizationExample() {
            const tokenizer = new Tokenizer();
            const exampleText = "The elephant is a large mammal with a distinctive trunk";
            const tokens = tokenizer.tokenize(exampleText);
            
            const tokenContainer = document.getElementById('tokenExample');
            tokenContainer.innerHTML = tokens.map(token => 
                `<span class="token">${token}</span>`
            ).join('');
        }
        
        function showTFIDFChart() {
            // Check if model is ready
            if (!searchEngine || !searchEngine.isReady) {
                return;
            }
            
            // Show TF-IDF values for a sample document
            const sampleDoc = knowledgeBase.find(d => d.title === 'Dolphin');
            const vector = searchEngine.vectorizer.transform(sampleDoc.text);
            
            // Get top 10 dimensions
            const dimensions = vector
                .map((value, idx) => ({
                    word: searchEngine.vectorizer.vocabulary[idx],
                    value: value
                }))
                .filter(d => d.value > 0)
                .sort((a, b) => b.value - a.value)
                .slice(0, 10);
            
            Highcharts.chart('tfidfChart', {
                chart: {
                    type: 'bar',
                    backgroundColor: 'transparent'
                },
                title: {
                    text: 'TF-IDF Scores for "Dolphin" Document',
                    style: {
                        fontFamily: "'Playfair Display', serif",
                        fontSize: '1.1rem',
                        color: '#10214b'
                    }
                },
                credits: { enabled: false },
                xAxis: {
                    categories: dimensions.map(d => d.word),
                    title: { text: 'Words' }
                },
                yAxis: {
                    title: { text: 'TF-IDF Score' }
                },
                legend: { enabled: false },
                series: [{
                    name: 'TF-IDF',
                    data: dimensions.map(d => d.value),
                    color: '#d7bd88'
                }]
            });
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initializeApp();
            }, 200);
        });
    </script>
</body>
</html>

